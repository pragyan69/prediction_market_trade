<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Polymarket Order UI (MetaMask)</title>
    <style>
      body { font-family: system-ui, Arial; margin: 20px; max-width: 860px; }
      .row { display: flex; gap: 12px; flex-wrap: wrap; margin: 10px 0; }
      label { display: block; font-size: 12px; opacity: 0.8; margin-bottom: 4px; }
      input, select, button, textarea { padding: 10px; font-size: 14px; width: 260px; }
      button { width: auto; cursor: pointer; }
      .card { border: 1px solid #ddd; border-radius: 10px; padding: 14px; margin: 14px 0; }
      .ok { color: #0a7a0a; }
      .bad { color: #b00020; }
      pre { background: #0b1020; color: #e6e6e6; padding: 12px; border-radius: 10px; overflow: auto; }
      .small { font-size: 12px; opacity: 0.8; }
      .wide { width: 100%; }

      /* Tabs */
      .tabs { display: flex; gap: 0; margin-bottom: 0; border-bottom: 2px solid #ddd; }
      .tab { padding: 12px 24px; cursor: pointer; border: 1px solid transparent; border-bottom: none; background: #f5f5f5; margin-bottom: -2px; }
      .tab.active { background: #fff; border-color: #ddd; border-bottom-color: #fff; font-weight: bold; }
      .tab-content { display: none; padding: 16px; border: 1px solid #ddd; border-top: none; }
      .tab-content.active { display: block; }

      /* Orders & Positions */
      .order-card, .position-card, .trade-card { border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px; margin: 10px 0; background: #fafafa; }
      .order-header, .position-header, .trade-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
      .order-side, .trade-side { padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 12px; }
      .order-side.buy, .trade-side.buy { background: #d4edda; color: #155724; }
      .order-side.sell, .trade-side.sell { background: #f8d7da; color: #721c24; }
      .order-id, .order-status { font-size: 12px; color: #666; }
      .order-details, .position-details, .trade-details { font-size: 13px; }
      .order-row, .position-row { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #eee; }
      .order-row:last-child, .position-row:last-child { border-bottom: none; }
      .label { color: #666; }
      .value { font-weight: 500; }
      .order-actions, .position-actions { margin-top: 10px; }
      .btn-cancel-order, .btn-close-position { background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
      .btn-cancel-order:hover, .btn-close-position:hover { background: #c82333; }
      .no-data { text-align: center; color: #666; padding: 20px; }
      .position-outcome { font-weight: bold; }
      .position-size { color: #0066cc; font-weight: 500; }
      .profit { color: #28a745; }
      .loss { color: #dc3545; }
      .section-actions { margin-bottom: 16px; display: flex; gap: 10px; }
      .section-actions button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
      .section-actions button:hover { background: #0056b3; }
      .section-actions button.danger { background: #dc3545; }
      .section-actions button.danger:hover { background: #c82333; }

      /* Position specific */
      .position-title { font-weight: bold; font-size: 14px; flex: 1; }
      .position-outcome-badge { padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: bold; }
      .position-outcome-badge.yes { background: #d4edda; color: #155724; }
      .position-outcome-badge.no { background: #f8d7da; color: #721c24; }
      .btn-copy-asset { background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 8px; }
      .btn-copy-asset:hover { background: #5a6268; }
      .asset-id { font-family: monospace; font-size: 11px; }

      /* Approval Status */
      .approval-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 8px; margin: 12px 0; }
      .approval-item { display: flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 6px; background: #f5f5f5; font-size: 13px; }
      .approval-item.approved { background: #d4edda; }
      .approval-item.pending { background: #fff3cd; }
      .approval-icon { font-size: 16px; }
      .approval-label { flex: 1; }
      .btn-approve-all { background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; }
      .btn-approve-all:hover { background: #218838; }
      .btn-approve-all:disabled { background: #ccc; cursor: not-allowed; }
      .approval-section { margin-top: 12px; padding-top: 12px; border-top: 1px solid #eee; }
      .approval-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
      .approval-title { font-weight: bold; font-size: 14px; }
      .all-approved { color: #28a745; font-weight: bold; }
    </style>
  </head>
  <body>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
      <h2>Polymarket CLOB â€” Place Order (MetaMask EOA)</h2>
      <div style="display: flex; gap: 10px;">
        <a href="/app.html" style="background: #22c55e; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600;">Live Trading (New)</a>
        <a href="/trade.html" style="background: #7c3aed; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600;">Trading App</a>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <button id="btnConnect">1) Connect MetaMask</button>
        <button id="btnDerive" disabled>2) Derive / Load User API Creds</button>
        <button id="btnClearCreds">Clear Saved Creds</button>
      </div>
      <div id="status" class="small"></div>
      <div class="small">
        Network required: <b>Polygon Mainnet (chainId 137)</b>. Trading uses USDC.e collateral on Polygon.
      </div>

      <!-- Approval Status Section -->
      <div id="approvalSection" class="approval-section" style="display: none;">
        <div class="approval-header">
          <span class="approval-title">Contract Approvals</span>
          <span id="approvalSummary" class="small"></span>
        </div>
        <div id="approvalGrid" class="approval-grid"></div>
        <div class="row">
          <button id="btnApproveAll" class="btn-approve-all" disabled>Approve All Missing</button>
          <button id="btnRefreshApprovals">Refresh Status</button>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>Order Params</h3>
      <div class="row">
        <div>
          <label>Token ID</label>
          <input id="tokenId" placeholder="TOKEN_ID (from Gamma API)" />
        </div>

        <div>
          <label>Side</label>
          <select id="side">
            <option value="BUY">BUY</option>
            <option value="SELL">SELL</option>
          </select>
        </div>

        <div>
          <label>Price</label>
          <input id="price" type="number" step="0.0001" placeholder="0.50" />
        </div>

        <div>
          <label>Size (shares)</label>
          <input id="size" type="number" step="0.0001" placeholder="10" />
        </div>

        <div>
          <label>Order Type</label>
          <select id="orderType">
            <option value="GTC">GTC</option>
            <option value="IOC">IOC</option>
            <option value="FOK">FOK</option>
          </select>
        </div>
      </div>

      <div class="row">
        <button id="btnVerify" disabled>3) Verify</button>
        <button id="btnPlace" disabled>4) Place Order</button>
      </div>

      <div class="small">
        Tip: Token IDs are obtained via Gamma market endpoints. :contentReference[oaicite:3]{index=3}
      </div>
    </div>

    <!-- Tabs for Orders, Positions, Trades -->
    <div class="card">
      <div class="tabs">
        <div class="tab active" data-tab="orders">Open Orders</div>
        <div class="tab" data-tab="positions">Positions</div>
        <div class="tab" data-tab="trades">Trade History</div>
      </div>

      <!-- Open Orders Tab -->
      <div id="ordersContainer" class="tab-content active" data-tab-content="orders">
        <div class="section-actions">
          <button id="btnRefreshOrders">Refresh Orders</button>
          <button id="btnCancelAllOrders" class="danger">Cancel All Orders</button>
        </div>
        <div id="ordersList">
          <p class="no-data">Click "Refresh Orders" to load your open orders.</p>
        </div>
      </div>

      <!-- Positions Tab -->
      <div id="positionsContainer" class="tab-content" data-tab-content="positions">
        <div class="section-actions">
          <button id="btnRefreshPositions">Refresh Positions</button>
        </div>
        <div id="positionsList">
          <p class="no-data">Click "Refresh Positions" to load your positions.</p>
        </div>
      </div>

      <!-- Trade History Tab -->
      <div id="tradesContainer" class="tab-content" data-tab-content="trades">
        <div class="section-actions">
          <button id="btnRefreshTrades">Refresh Trade History</button>
        </div>
        <div id="tradesList">
          <p class="no-data">Click "Refresh Trade History" to load your recent trades.</p>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>Output</h3>
      <pre id="log"></pre>
    </div>

    <script type="module" src="/src/main.ts"></script>
    <script type="module" src="/src/app.ts"></script>
    <script>
      // Tab switching logic
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.dataset.tab;

          // Update active tab
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');

          // Update active content
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
            if (content.dataset.tabContent === tabName) {
              content.classList.add('active');
            }
          });
        });
      });
    </script>
  </body>
</html>
